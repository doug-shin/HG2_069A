# 35kW DC-DC 컨버터 제어 시스템 - Cursor 개발 가이드

## 프로젝트 개요
TMS320F28069 마이크로컨트롤러 기반 35kW DC-DC 컨버터 제어 시스템
마스터/슬레이브 병렬 운전 구조

## 기본 개발 규칙 (필수)

### C 프로그래밍 표준
- C89/90 표준으로 프로그래밍 (TI C2000 컴파일러 호환성)
- 주석은 `//`와 `/* */` 스타일 자유롭게 사용
- 사용자가 요청하면 Doxygen 스타일 문서화 적용

### 하드웨어 및 드라이버 (변경 금지)
- **프로세서**: F28069
- **드라이버 서포트 파일**: 수정하지 않음
- **헤더 파일 위치**: `/Users/dugkyunshin/ti/c2000/C2000Ware_5_04_00_00/device_support/f2806x/headers/include`
- **소스 파일 위치**: `/Users/dugkyunshin/ti/c2000/C2000Ware_5_04_00_00/device_support/f2806x/common/source`
- **프로젝트 파일**: `/Users/dugkyunshin/ti/c2000/C2000Ware_5_04_00_00/device_support/f2806x/common/include/DSP28x_Project.h`
- **변수 타입/매크로**: `/Users/dugkyunshin/ti/c2000/C2000Ware_5_04_00_00/device_support/f2806x/headers/include/F2806x_Device.h`

### 빌드 및 커밋 정책
- **컴파일**: CCS 사용, 별도 요청 없으면 시도하지 않음
- **커밋**: 사용자가 직접 빌드 확인 후 커밋, 별도 요청 없으면 시도하지 않음
- **Include 경로**: 별도 지정하지 않으며 에러는 무시
- **프로젝트 파일**: 별도 파일을 통해 드라이버 서포트 파일 포함

## 현재 시스템 구조 (참고용 - 리팩토링 시 변경 가능)

### 통신 아키텍처
```
제어 컴퓨터 ↔ 마스터: SCI Modbus RTU (38400bps) + CAN Protocol (500kbps)
마스터 → 슬레이브: SCI 485 (5.625Mbps, 전류지령 브로드캐스팅)
슬레이브 → 마스터: CAN (500kbps, 전류 피드백)
```

### 제어 시스템
- **PI 제어**: 20kHz 실행 (50μs 샘플링)
- **메인 루프**: `epwm3_isr` (100kHz → 20kHz 분주)
- **DCL 라이브러리**: 성능 최적화 옵션 (`use_dcl_controller` 플래그)

### Protocol 시스템 (별도 추가)
- **구현**: `protocol.c/h` 파일
- **CAN 메일박스**: MBOX 16~31 사용
- **기존 시스템**: 독립적으로 동작

## 개발 지원 가이드라인

### 코드 수정 시 고려사항
- **드라이버 파일**: 절대 수정 금지
- **핵심 제어 알고리즘**: 신중하게 수정 (PI 컨트롤러, 안전 기능)
- **애플리케이션 로직**: 자유롭게 수정 가능
- **통신 프로토콜**: 자유롭게 수정 가능

### 성능 최적화 옵션
- DCL 라이브러리 함수 우선 고려 (약 65% 성능 향상)
- 시간 임계 함수는 RAM 실행 고려 (`#pragma CODE_SECTION`)
- 고주파 루프에서 부동소수점 연산 최소화

### 안전 기능 (유지 권장)
- 하드웨어 폴트 감지
- 과전압 보호
- 소프트 스타트 제어

## 리팩토링 지원

### 구조 변경 시 참고사항
- 현재 구조는 참고용이며 리팩토링 시 자유롭게 변경 가능
- 사용자가 구조 변경을 원하면 해당 방향으로 지원
- 기존 구조에 얽매이지 말고 사용자 요구사항 우선

### 규칙 충돌 시 대응
- 사용자 요구사항이 규칙과 충돌하면 사용자 요구사항 우선
- 규칙 변경이 필요하면 명시적으로 안내
- "규칙에 따라 이렇게 했습니다"라고 명시하여 사용자가 판단할 수 있도록 함

## 응답 정책
- 한국어/영어 사용자 언어에 따라 응답
- 기술적 정확성 유지
- 사용자 의도 파악 우선, 규칙은 참고용으로 활용 